<!DOCTYPE html>
<html>
<head>
  <title>Courses</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body>
<div class="container my-5">
  <h1 class="mb-4">Available Courses</h1>

  {% if error %}
  <div class="alert alert-danger">{{ error }}</div>
  {% endif %}

  <!-- Search and Filter Form -->
  <form method="POST" action="{{ url_for('course_list') }}" class="mb-4">
    <div class="row g-3">
      <div class="col-md-4">
        <input type="text" name="search" class="form-control" placeholder="Search courses..." value="{{ request.form.get('search', '') }}">
      </div>

      <div class="col-md-3">
        <div class="input-group">
          <input type="number" step="0.01" name="budget" class="form-control" placeholder="Budget in €" value="{{ request.form.get('budget', '') }}">
          <span class="input-group-text">€</span>
        </div>
      </div>

      <div class="col-md-3">
        <select name="gender" class="form-select">
          <option value="">Select Gender</option>
          <option value="female" {% if request.form.get('gender') == 'female' %}selected{% endif %}>Female</option>
          <option value="male" {% if request.form.get('gender') == 'male' %}selected{% endif %}>Male</option>
          <option value="other" {% if request.form.get('gender') == 'other' %}selected{% endif %}>Other</option>
        </select>
      </div>

      <div class="col-md-2">
        <button type="submit" class="btn btn-primary w-100">Search</button>
      </div>
    </div>

    <!-- Target Groups -->
    <div class="row mt-3">
      <label>Target Groups:</label>
      <div class="d-flex flex-wrap gap-3">
        {% for label in ['People with a migration background', 'Illiterate people', 'People with disabilities', 'Older adults / older people', 'Other target groups', 'Children', 'Adolescents / young people', 'Not Applicable'] %}
        <div class="form-check">
          <input class="form-check-input" type="checkbox" name="target_group" value="{{ label }}"
                 {% if label in request.form.getlist('target_group') %}checked{% endif %}>
          <label class="form-check-label">{{ label }}</label>
        </div>
        {% endfor %}
      </div>
    </div>
  </form>

  <!-- Courses Table -->
  <table class="table table-bordered table-hover mt-4">
    <thead class="table-light">
      <tr>
        <th>Course Title</th>
        <th>District</th>
        <th>Location</th>
        <th>Price (€)</th>
        <th>Course Duration</th>
        <th>Session Times</th>
        <th>No. of Sessions</th>
        <th>Sponsored</th>
        <th>Link</th>
      </tr>
    </thead>
    <tbody>
      {% for course in courses %}
      <tr>
        <td>{{ course['course_name_translated'] }}</td>
        <td>{{ course['district'] }}</td>
        <td>
          {% if course['locations_address'] and course['locations_address'][0] %}
            {{ course['locations_address'][0]['strasse'] }},
            {{ course['locations_address'][0]['plz'] }} {{ course['locations_address'][0]['ort'] }}
          {% else %}
            Not Available
          {% endif %}
        </td>
        <td>{{ course['price_amount'] | default('N/A') }}</td>
        <td>{{ course['start_date'] }} to {{ course['end_date'] }}</td>
        <td>
          {% if course['locations_appointments'] and course['locations_appointments'][0] %}
            {{ course['locations_appointments'][0]['beginn_uhrzeit'] }}
            to {{ course['locations_appointments'][0]['ende_uhrzeit'] }}
          {% else %}
            Not Available
          {% endif %}
        </td>
        <td>{{ course['number_of_sessions'] }}</td>
        <td>
          {% if course['website_uri'] %}
            <a href="{{ course['website_uri'] }}" target="_blank">Book</a>
          {% else %}
            Not Available
          {% endif %}
        </td>
        <td>{{ 'Sponsored' if course.sponsored == 1 else '-' }}</td>
      </tr>
      {% endfor %}
    </tbody>
  </table>
</div>
</body>
</html>

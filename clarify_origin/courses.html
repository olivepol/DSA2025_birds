{% extends "layout.html" %}

{% block content %}
<div class="container my-5">
    <h1 class="text-left mb-4">All Courses</h1>

     <!-- Search Bar --> 
     <form method="GET" action="{{ url_for('course_list') }}" class="mb-4">
        <div class="row g-3">
        
            <!-- Search Field -->
            <div class="col-md-6 col-lg-4">
                <div class="input-group">
                    <input type="text" name="search" class="form-control" placeholder="Search for courses..." value="{{ request.args.get('search', '') }}">
                    <button class="btn btn-primary" type="submit">Search</button>
                </div>
            </div>

            <!-- Gender Filter -->
            <div class="col-md-6 col-lg-4">
                <div class="input-group">
                    <label class="input-group-text" for="gender">Gender</label>
                    <select class="form-select" id="gender" name="gender">
                        <option value="" {% if not request.args.get('gender') %}selected{% endif %}>All</option>
                        <option value="female" {% if request.args.get('gender') == 'female' %}selected{% endif %}>Female</option>
                        <option value="male" {% if request.args.get('gender') == 'male' %}selected{% endif %}>Male</option>
                        <option value="other" {% if request.args.get('gender') == 'other' %}selected{% endif %}>Other</option>
                    </select>
                </div>
            </div>

            <!-- Target Group Filter -->
            <div class="col-md-6 col-lg-4">
                <div class="input-group w-100" style="width: 100%;">
                    <label class="input-group-text">Target Group</label>
                    <div class="dropdown">
                        <button class="btn btn-secondary dropdown-toggle" type="button" id="targetGroupDropdown" data-bs-toggle="dropdown" aria-expanded="false">
                            Select Target Groups
                        </button>
                        <ul class="dropdown-menu p-3" aria-labelledby="targetGroupDropdown" style="max-height: 300px; overflow-y: auto;">
                            <!-- Select All Option -->
                            <li>
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" id="select_all_target_groups" onclick="toggleAllTargetGroups(this)">
                                    <label class="form-check-label" for="select_all_target_groups">Select All</label>
                                </div>
                            </li>
                            <!-- Individual Target Groups -->
                            <li>
                                <div class="form-check">
                                    <input class="form-check-input target-group-checkbox" type="checkbox" name="target_group" value="People with a migration background" id="target_group_migration" {% if 'People with a migration background' in request.args.getlist('target_group') %}checked{% endif %}>
                                    <label class="form-check-label" for="target_group_migration">People with a migration background</label>
                                </div>
                            </li>
                            <li>
                                <div class="form-check">
                                    <input class="form-check-input target-group-checkbox" type="checkbox" name="target_group" value="Illiterate people" id="target_group_illiterate" {% if 'Illiterate people' in request.args.getlist('target_group') %}checked{% endif %}>
                                    <label class="form-check-label" for="target_group_illiterate">Illiterate people</label>
                                </div>
                            </li>
                            <li>
                                <div class="form-check">
                                    <input class="form-check-input target-group-checkbox" type="checkbox" name="target_group" value="Women" id="target_group_women" {% if 'Women' in request.args.getlist('target_group') %}checked{% endif %}>
                                    <label class="form-check-label" for="target_group_women">Women</label>
                                </div>
                            </li>
                            <li>
                                <div class="form-check">
                                    <input class="form-check-input target-group-checkbox" type="checkbox" name="target_group" value="People with disabilities" id="target_group_disabilities" {% if 'People with disabilities' in request.args.getlist('target_group') %}checked{% endif %}>
                                    <label class="form-check-label" for="target_group_disabilities">People with disabilities</label>
                                </div>
                            </li>
                            <li>
                                <div class="form-check">
                                    <input class="form-check-input target-group-checkbox" type="checkbox" name="target_group" value="Older adults / older people" id="target_group_older_adults" {% if 'Older adults / older people' in request.args.getlist('target_group') %}checked{% endif %}>
                                    <label class="form-check-label" for="target_group_older_adults">Older adults / older people</label>
                                </div>
                            </li>
                            <li>
                                <div class="form-check">
                                    <input class="form-check-input target-group-checkbox" type="checkbox" name="target_group" value="Other target groups" id="target_group_other" {% if 'Other target groups' in request.args.getlist('target_group') %}checked{% endif %}>
                                    <label class="form-check-label" for="target_group_other">Other target groups</label>
                                </div>
                            </li>
                            <li>
                                <div class="form-check">
                                    <input class="form-check-input target-group-checkbox" type="checkbox" name="target_group" value="Children" id="target_group_children" {% if 'Children' in request.args.getlist('target_group') %}checked{% endif %}>
                                    <label class="form-check-label" for="target_group_children">Children</label>
                                </div>
                            </li>
                            <li>
                                <div class="form-check">
                                    <input class="form-check-input target-group-checkbox" type="checkbox" name="target_group" value="Adolescents / young people" id="target_group_adolescents" {% if 'Adolescents / young people' in request.args.getlist('target_group') %}checked{% endif %}>
                                    <label class="form-check-label" for="target_group_adolescents">Adolescents / young people</label>
                                </div>
                            </li>
                        </ul>
                    </div>
                </div>
            </div>

            <!-- Budget imput -->
            <div class="col-md-6 col-lg-4">
                <div class="input-group">
                  <label class="input-group-text" for="budget">Budget</label>
                  <input type="number" class="form-control" id="budget" name="budget" placeholder="Enter Budget" value="{{ request.args.get('budget', '') }}">
                  <span class="input-group-text">€</span>
                </div>
              </div>

    <!-- Selected Filters Display -->
    <div class="row g-2">
        <!-- Target Group Filter -->
        {% if request.args.getlist('target_group') %}
            <div class="col-auto">
                <span class="badge bg-light text-dark">Target Groups: {{ request.args.getlist('target_group')|join(', ') }}</span>
            </div>
        {% endif %}

        <!-- Gender Filter -->
        {% if request.args.get('gender') %}
            <div class="col-auto">
                <span class="badge bg-light text-dark">Gender: {{ request.args.get('gender') }}</span>
            </div>
        {% endif %}

          <!-- Results count -->
     <div class="mb-3">
        <h5>{{ courses|length }} courses found</h5>
    </div>

    <table class="table table-striped table-bordered" style="width:100%; overflow-x:auto; overflow-y:auto;">
        <thead>
            <tr>
                <th>Course Title</th>
                <th>District</th>
                <th>Location</th>
                <th>Price</th>
                <th>Course Duration</th>
                <th>Session Times</th>
                <th>No. of Sessions</th>
                <th>Link</th>
            </tr>
        </thead>
        <tbody>
            {% for course in courses %}
                {% if course['ortetermine'] and course['ortetermine']['adresse'] and course['ortetermine']['termin'] %}
                    {% if course['ortetermine']['adresse']|length > 0 and course['ortetermine']['termin']|length > 0 %}
                        <tr>
                            <td>{{ course['name'] }}</td>
                            <td>{{ course['bezirk'] }}</td>
                            <td>
                                {% if course['ortetermine']['adresse'][0] %}
                                    {{ course['ortetermine']['adresse'][0]['strasse'] }},
                                    {{ course['ortetermine']['adresse'][0]['plz'] }} {{ course['ortetermine']['adresse'][0]['ort'] }}
                                {% else %}
                                    Not Available
                                {% endif %}
                            </td>
                            <!-- Price column - Fixed -->
                            <td>
                                {% if course['preis'] and course['preis']['betrag'] %}
                                     {{ course['preis']['betrag'] }}€
                                {% else %}
                                     Not Available
                                {% endif %}
                            </td>
                            <td>
                                {{ course['beginn_datum'] }} to {{ course['ende_datum'] }}
                            </td>
                            <td>
                                {% if course['ortetermine']['termin'][0] %}
                                    {{ course['ortetermine']['termin'][0]['beginn_uhrzeit'] }} to {{ course['ortetermine']['termin'][0]['ende_uhrzeit'] }}
                                {% else %}
                                    Not Available
                                {% endif %}
                            </td>
                            <td>{{ course['ortetermine']['termin']|length }}</td>
                            <td>
                                {% if course['webadresse'] and course['webadresse']['uri'] %}
                                    <a href="{{ course['webadresse']['uri'] }}">Book Course</a>
                                {% else %}
                                    Not Available
                                {% endif %}
                            </td>
                        </tr>
                    {% else %}
                        <tr><td colspan="7">No sessions or locations available for this course.</td></tr>
                    {% endif %}
                {% else %}
                    <tr><td colspan="7">No sessions or locations available for this course.</td></tr>
                {% endif %}
            {% endfor %}
        </tbody>
    </table>
</div>
{% endblock %}
